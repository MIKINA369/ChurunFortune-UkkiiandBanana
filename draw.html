<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Churun Fortune Ⅱ｜風がめくる朝</title>
<link rel="stylesheet" href="style.css">

</head>
<body>

<div class="sky"></div>
<div class="breeze"></div>

<div class="wrap">
  <div>
    <p class="title">🫧 あなたに舞い降りた詩</p>
    <p class="subtitle">静けさののち、風と光が言葉を運ぶ。</p>

    <div id="poemBox" aria-live="polite">
      <p id="poemTitle" style="opacity:.8;margin:.2rem 0 .8rem;"></p>
      <p id="poem"></p>
    </div>

    <a id="reload" href="omikuji.html" aria-label="もう一度、風に触れる">もう一度、風に触れる</a>
  </div>
</div>

<!-- 音：風（先にやさしく）、次に鈴音（光の合図） -->
<audio id="wind" src="https://cdn.pixabay.com/download/audio/2022/03/14/audio_2ce57d3ef8.mp3?filename=soft-wind-ambient-14059.mp3"></audio>
<audio id="bell" src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_8bdb0b7d52.mp3?filename=quiet-wind-chimes-6906.mp3"></audio>

<script>
// ====== 音・光・要素参照 ======
const wind = document.getElementById('wind');
const bell = document.getElementById('bell');
const poemBox = document.getElementById('poemBox');
const poemEl  = document.getElementById('poem');
const reloadBtn = document.getElementById('reload');

wind.volume = 0.25; bell.volume = 0.20;

/* ① ユーザー操作で音を解禁（ナビ後のページでも確実に鳴る） */
function enableSoundOnce(){
  wind && wind.play().catch(()=>{});
  setTimeout(()=> bell && bell.play().catch(()=>{}), 1200);
  window.removeEventListener('pointerdown', enableSoundOnce);
}
window.addEventListener('pointerdown', enableSoundOnce, { once:true });

/* ② ページロード後に “ふわり” を発火（CSSの .show 連動） */
window.addEventListener('load', () => {
  if (poemBox) poemBox.classList.add('show');
});

/* ③ 詩の抽選と描画 */
const poems = [ /* ← ここは今の配列のままOK */ ];

window.addEventListener('load', () => {
  const text = poems[Math.floor(Math.random()*poems.length)];
  const tag  = pickTagByPoemIndex(text);

  // バッジ
  const badge = document.createElement('span');
  badge.classList.add('badge');
  badge.dataset.theme = pickThemeByTag(tag);
  badge.textContent = tag;
  poemBox.prepend(badge);

  // ささやき表示
  typePoem(text, poemEl, 22);

  // ボタンの出現タイミング（少し早めにしたいなら 1800〜2200ms）
  setTimeout(()=>{
    reloadBtn.style.opacity = 1;
    reloadBtn.style.transform = 'translateY(0)';
  }, 2200);
});

/* ユーティリティ */
function typePoem(text, container, stepMs=24){
  container.innerHTML = '';
  [...text].forEach((ch, i)=>{
    const span = document.createElement('span');
    span.className = 'char';
    span.style.animationDelay = (i*stepMs/1000)+'s';
    span.textContent = ch;
    container.appendChild(span);
  });
}
function pickTagByPoemIndex(t){
  const i = poems.indexOf(t);
  const map = [
    "🌙 夢チュルン","🌙 夢チュルン","🌙 夢チュルン","🌙 夢チュルン",
    "🕯 灯火チュルン","🕯 灯火チュルン","🕯 灯火チュルン","🕯 灯火チュルン",
    "🌊 記憶チュルン","🌊 記憶チュルン","🌊 記憶チュルン","🌊 記憶チュルン",
    "🌬 境界チュルン","🌬 境界チュルン","🌬 境界チュルン","🌬 境界チュルン",
    "🌅 夜明けチュルン","🌅 夜明けチュルン","🌅 夜明けチュルン","🌅 夜明けチュルン"
  ];
  return map[i] || "🫧";
}
function pickThemeByTag(tag){
  if(tag.includes("夢")) return "dream";
  if(tag.includes("灯")) return "light";
  if(tag.includes("記憶")) return "memory";
  if(tag.includes("境界")) return "border";
  if(tag.includes("夜明け")) return "dawn";
  return "default";
}
</script>
  <div class="candle" aria-hidden="true">
  <div class="flame"></div>
</div>
</body>
</html>
