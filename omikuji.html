<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Churun Fortune â…¡ï½œé¢¨ãŒã‚ãã‚‹æœ</title>
<link rel="stylesheet" href="style.css">

</head>
<body>

<div class="sky"></div>
<div class="breeze"></div>

<div class="wrap">
  <div>
    <p class="title">ğŸ«§ ã‚ãªãŸã«èˆã„é™ã‚ŠãŸè©©</p>
    <p class="subtitle">é™ã‘ã•ã®ã®ã¡ã€é¢¨ã¨å…‰ãŒè¨€è‘‰ã‚’é‹ã¶ã€‚</p>

    <div id="poemBox" aria-live="polite">
      <p id="poemTitle" style="opacity:.8;margin:.2rem 0 .8rem;"></p>
      <p id="poem"></p>
    </div>

    <a id="reload" href="omikuji.html" aria-label="ã‚‚ã†ä¸€åº¦ã€é¢¨ã«è§¦ã‚Œã‚‹">ã‚‚ã†ä¸€åº¦ã€é¢¨ã«è§¦ã‚Œã‚‹</a>
  </div>
</div>

<!-- éŸ³ï¼šé¢¨ï¼ˆå…ˆã«ã‚„ã•ã—ãï¼‰ã€æ¬¡ã«éˆ´éŸ³ï¼ˆå…‰ã®åˆå›³ï¼‰ -->
<audio id="wind" src="https://cdn.pixabay.com/download/audio/2022/03/14/audio_2ce57d3ef8.mp3?filename=soft-wind-ambient-14059.mp3"></audio>
<audio id="bell" src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_8bdb0b7d52.mp3?filename=quiet-wind-chimes-6906.mp3"></audio>

<script>
// ====== éŸ³ãƒ»å…‰ãƒ»è¦ç´ å‚ç…§ ======
const wind = document.getElementById('wind');
const bell = document.getElementById('bell');
const poemBox = document.getElementById('poemBox');
const poemEl  = document.getElementById('poem');
const reloadBtn = document.getElementById('reload');

wind.volume = 0.25; bell.volume = 0.20;

/* â‘  ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§éŸ³ã‚’è§£ç¦ï¼ˆãƒŠãƒ“å¾Œã®ãƒšãƒ¼ã‚¸ã§ã‚‚ç¢ºå®Ÿã«é³´ã‚‹ï¼‰ */
function enableSoundOnce(){
  wind && wind.play().catch(()=>{});
  setTimeout(()=> bell && bell.play().catch(()=>{}), 1200);
  window.removeEventListener('pointerdown', enableSoundOnce);
}
window.addEventListener('pointerdown', enableSoundOnce, { once:true });

/* â‘¡ ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰å¾Œã« â€œãµã‚ã‚Šâ€ ã‚’ç™ºç«ï¼ˆCSSã® .show é€£å‹•ï¼‰ */
window.addEventListener('load', () => {
  if (poemBox) poemBox.classList.add('show');
});

/* â‘¢ è©©ã®æŠ½é¸ã¨æç”» */
const poems = [ /* â† ã“ã“ã¯ä»Šã®é…åˆ—ã®ã¾ã¾OK */ ];

window.addEventListener('load', () => {
  const text = poems[Math.floor(Math.random()*poems.length)];
  const tag  = pickTagByPoemIndex(text);

  // ãƒãƒƒã‚¸
  const badge = document.createElement('span');
  badge.classList.add('badge');
  badge.dataset.theme = pickThemeByTag(tag);
  badge.textContent = tag;
  poemBox.prepend(badge);

  // ã•ã•ã‚„ãè¡¨ç¤º
  typePoem(text, poemEl, 22);

  // ãƒœã‚¿ãƒ³ã®å‡ºç¾ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆå°‘ã—æ—©ã‚ã«ã—ãŸã„ãªã‚‰ 1800ã€œ2200msï¼‰
  setTimeout(()=>{
    reloadBtn.style.opacity = 1;
    reloadBtn.style.transform = 'translateY(0)';
  }, 2200);
});

/* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
function typePoem(text, container, stepMs=24){
  container.innerHTML = '';
  [...text].forEach((ch, i)=>{
    const span = document.createElement('span');
    span.className = 'char';
    span.style.animationDelay = (i*stepMs/1000)+'s';
    span.textContent = ch;
    container.appendChild(span);
  });
}
function pickTagByPoemIndex(t){
  const i = poems.indexOf(t);
  const map = [
    "ğŸŒ™ å¤¢ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ™ å¤¢ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ™ å¤¢ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ™ å¤¢ãƒãƒ¥ãƒ«ãƒ³",
    "ğŸ•¯ ç¯ç«ãƒãƒ¥ãƒ«ãƒ³","ğŸ•¯ ç¯ç«ãƒãƒ¥ãƒ«ãƒ³","ğŸ•¯ ç¯ç«ãƒãƒ¥ãƒ«ãƒ³","ğŸ•¯ ç¯ç«ãƒãƒ¥ãƒ«ãƒ³",
    "ğŸŒŠ è¨˜æ†¶ãƒãƒ¥ãƒ«ãƒ³","ğŸŒŠ è¨˜æ†¶ãƒãƒ¥ãƒ«ãƒ³","ğŸŒŠ è¨˜æ†¶ãƒãƒ¥ãƒ«ãƒ³","ğŸŒŠ è¨˜æ†¶ãƒãƒ¥ãƒ«ãƒ³",
    "ğŸŒ¬ å¢ƒç•Œãƒãƒ¥ãƒ«ãƒ³","ğŸŒ¬ å¢ƒç•Œãƒãƒ¥ãƒ«ãƒ³","ğŸŒ¬ å¢ƒç•Œãƒãƒ¥ãƒ«ãƒ³","ğŸŒ¬ å¢ƒç•Œãƒãƒ¥ãƒ«ãƒ³",
    "ğŸŒ… å¤œæ˜ã‘ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ… å¤œæ˜ã‘ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ… å¤œæ˜ã‘ãƒãƒ¥ãƒ«ãƒ³","ğŸŒ… å¤œæ˜ã‘ãƒãƒ¥ãƒ«ãƒ³"
  ];
  return map[i] || "ğŸ«§";
}
function pickThemeByTag(tag){
  if(tag.includes("å¤¢")) return "dream";
  if(tag.includes("ç¯")) return "light";
  if(tag.includes("è¨˜æ†¶")) return "memory";
  if(tag.includes("å¢ƒç•Œ")) return "border";
  if(tag.includes("å¤œæ˜ã‘")) return "dawn";
  return "default";
}
</script>
  <div class="candle" aria-hidden="true">
  <div class="flame"></div>
</div>
</body>
</html>
